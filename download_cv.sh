set -e
LANGUAGES=(
    "ab"
    "af"
    "sq"
    "am"
    "ar"
    "hy-AM"
    "as"
    "ast"
    "az"
    "bas"
    "ba"
    "eu"
    "be"
    "bn"
    "br"
    "bg"
    "yue"
    "ca"
    "ckb"
    "zh-CN"
    "zh-HK"
    "zh-TW"
    "cv"
    "cs"
    "da"
    "dv"
    "dyu"
    "nl"
    "en"
    "myv"
    "eo"
    "et"
    "fi"
    "fr"
    "fy-NL"
    "gl"
    "ka"
    "de"
    "el"
    "gn"
    "cnh"
    "ha"
    "he"
    "mrj"
    "hi"
    "hu"
    "is"
    "ig"
    "id"
    "ia"
    "ga-IE"
    "it"
    "ja"
    "kab"
    "kk"
    "rw"
    "ko"
    "kmr"
    "ky"
    "lo"
    "ltg"
    "lv"
    "lij"
    "lt"
    "lg"
    "mk"
    "ml"
    "mt"
    "mr"
    "mhr"
    "mdf"
    "mn"
    "ne-NP"
    "nn-NO"
    "oc"
    "or"
    "os"
    "ps"
    "fa"
    "pl"
    "pt"
    "pa-IN"
    "quy"
    "ro"
    "rm-sursilv"
    "rm-vallader"
    "ru"
    "sah"
    "sat"
    "skr"
    "sc"
    "sr"
    "sk"
    "sl"
    "hsb"
    "es"
    "sw"
    "sv-SE"
    "nan-tw"
    "zgh"
    "ta"
    "tt"
    "te"
    "th"
    "tig"
    "ti"
    "tok"
    "tr"
    "tk"
    "tw"
    "uk"
    "ur"
    "ug"
    "uz"
    "vi"
    "vot"
    "cy"
    "nhi"
    "yi"
    "yo"
)

# Download
for LG in ${LANGUAGES[@]}
do
    # Fetch Link
    echo "Fetching link for ${LG}..."
    URL="https://commonvoice.mozilla.org/api/v1/bucket/dataset/cv-corpus-16.0-2023-12-06%2Fcv-corpus-16.0-2023-12-06-${LG}.tar.gz"
    URL_FIELD=$(wget -q -O - "$URL" | jq -r '.url')

    # Download and Extract
    echo "Downloading ${LG}..."
    DOWNLOAD_PATH="./dataset/source/common_voice_${LG}.tar.gz"
    aria2c -x8 --file-allocation=none "$URL_FIELD" -o "$DOWNLOAD_PATH"
done

# Extract
for LG in ${LANGUAGES[@]}
do
    mkdir -p "./dataset/source/source_common_voice_${LG}"
    echo "Extracting ${LG}..."
    DOWNLOAD_PATH="./dataset/source/common_voice_${LG}.tar.gz"
    EXTRACT_PATH="./dataset/source/source_common_voice_${LG}"
    tar -xzf "$DOWNLOAD_PATH" -C "$EXTRACT_PATH" --strip-components=1
done

# Delete
for LG in ${LANGUAGES[@]}
do
    DOWNLOAD_PATH="./dataset/source/common_voice_${LG}.tar.gz"
    rm "$DOWNLOAD_PATH"
done